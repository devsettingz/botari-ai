{"version":3,"file":"botari-widget.es.js","sources":["../src/api.ts","../src/ChatWidget.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Botari Widget API Client\r\n * Handles all communication with the Botari backend\r\n */\r\n\r\nimport type { \r\n  WidgetConfig, \r\n  Conversation, \r\n  Message, \r\n  CreateConversationResponse, \r\n  SendMessageResponse \r\n} from './types';\r\n\r\nexport class BotariAPI {\r\n  private config: Required<Pick<WidgetConfig, 'apiUrl' | 'apiKey' | 'businessId'>>;\r\n  private conversationId: number | null = null;\r\n\r\n  constructor(config: WidgetConfig) {\r\n    this.config = {\r\n      apiUrl: config.apiUrl || 'http://localhost:4000',\r\n      apiKey: config.apiKey,\r\n      businessId: config.businessId,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the current conversation ID\r\n   */\r\n  getConversationId(): number | null {\r\n    return this.conversationId;\r\n  }\r\n\r\n  /**\r\n   * Set conversation ID (used when restoring from storage)\r\n   */\r\n  setConversationId(id: number): void {\r\n    this.conversationId = id;\r\n  }\r\n\r\n  /**\r\n   * Create headers for API requests\r\n   */\r\n  private getHeaders(): Record<string, string> {\r\n    return {\r\n      'Content-Type': 'application/json',\r\n      'X-API-Key': this.config.apiKey,\r\n      'X-Business-ID': String(this.config.businessId),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a new conversation\r\n   */\r\n  async createConversation(customerInfo?: { name?: string; phone?: string }): Promise<number> {\r\n    const response = await fetch(`${this.config.apiUrl}/api/conversations`, {\r\n      method: 'POST',\r\n      headers: this.getHeaders(),\r\n      body: JSON.stringify({\r\n        customer_name: customerInfo?.name || 'Website Visitor',\r\n        customer_phone: customerInfo?.phone || '',\r\n        employee_id: 1, // Default AI employee\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n      throw new Error(error.error || `Failed to create conversation: ${response.status}`);\r\n    }\r\n\r\n    const data: CreateConversationResponse = await response.json();\r\n    this.conversationId = data.conversation_id;\r\n    return data.conversation_id;\r\n  }\r\n\r\n  /**\r\n   * Get messages for the current conversation\r\n   */\r\n  async getMessages(conversationId?: number): Promise<Message[]> {\r\n    const id = conversationId || this.conversationId;\r\n    if (!id) {\r\n      throw new Error('No conversation ID available');\r\n    }\r\n\r\n    const response = await fetch(\r\n      `${this.config.apiUrl}/api/conversations/${id}/messages`,\r\n      {\r\n        method: 'GET',\r\n        headers: this.getHeaders(),\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n      throw new Error(error.error || `Failed to get messages: ${response.status}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Send a message and get AI response\r\n   */\r\n  async sendMessage(text: string, sender: string = 'user'): Promise<string> {\r\n    if (!this.conversationId) {\r\n      await this.createConversation();\r\n    }\r\n\r\n    const response = await fetch(`${this.config.apiUrl}/api/messages`, {\r\n      method: 'POST',\r\n      headers: this.getHeaders(),\r\n      body: JSON.stringify({\r\n        conversation_id: this.conversationId,\r\n        sender,\r\n        text,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n      throw new Error(error.error || `Failed to send message: ${response.status}`);\r\n    }\r\n\r\n    const data: SendMessageResponse = await response.json();\r\n    return data.reply;\r\n  }\r\n\r\n  /**\r\n   * Close the current conversation\r\n   */\r\n  async closeConversation(conversationId?: number): Promise<void> {\r\n    const id = conversationId || this.conversationId;\r\n    if (!id) return;\r\n\r\n    const response = await fetch(\r\n      `${this.config.apiUrl}/api/conversations/${id}/close`,\r\n      {\r\n        method: 'PUT',\r\n        headers: this.getHeaders(),\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      console.error('Failed to close conversation');\r\n    }\r\n\r\n    this.conversationId = null;\r\n  }\r\n\r\n  /**\r\n   * Check if API is reachable\r\n   */\r\n  async healthCheck(): Promise<boolean> {\r\n    try {\r\n      const response = await fetch(`${this.config.apiUrl}/health`, {\r\n        method: 'GET',\r\n        headers: { 'X-API-Key': this.config.apiKey },\r\n      });\r\n      return response.ok;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default BotariAPI;\r\n","/**\r\n * Botari Chat Widget\r\n * Main widget class that handles UI and interactions\r\n */\r\n\r\nimport type { WidgetConfig, WidgetInstance, Message, WidgetState } from './types';\r\nimport { BotariAPI } from './api';\r\n\r\n// SVG Icons\r\nconst ICONS = {\r\n  chat: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z\"/></svg>`,\r\n  close: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>`,\r\n  send: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m22 2-7 20-4-9-9-4z\"/><path d=\"M22 2 11 13\"/></svg>`,\r\n  minimize: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M4 14h6v6\"/><path d=\"M20 10h-6V4\"/><path d=\"M14 10 4 20\"/><path d=\"m20 4-10 10\"/></svg>`,\r\n  clear: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 6h18\"/><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/></svg>`,\r\n  bot: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 8V4H8\"/><rect width=\"16\" height=\"12\" x=\"4\" y=\"8\" rx=\"2\"/><path d=\"M2 14h2\"/><path d=\"M20 14h2\"/><path d=\"M15 13v2\"/><path d=\"M9 13v2\"/></svg>`,\r\n  user: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/></svg>`,\r\n};\r\n\r\nexport class ChatWidget implements WidgetInstance {\r\n  private config: Required<WidgetConfig>;\r\n  private api: BotariAPI;\r\n  private state: WidgetState = 'closed';\r\n  private messages: Message[] = [];\r\n  private container: HTMLElement | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private window: HTMLElement | null = null;\r\n  private messagesContainer: HTMLElement | null = null;\r\n  private input: HTMLTextAreaElement | null = null;\r\n  private isTyping = false;\r\n  private autoOpenTimer: number | null = null;\r\n  private storageKey: string;\r\n  private customerName: string = 'You';\r\n\r\n  constructor(config: WidgetConfig) {\r\n    // Validate required config\r\n    if (!config.businessId) {\r\n      throw new Error('BotariWidget: businessId is required');\r\n    }\r\n    if (!config.apiKey) {\r\n      throw new Error('BotariWidget: apiKey is required');\r\n    }\r\n\r\n    // Set default config\r\n    this.config = {\r\n      businessId: config.businessId,\r\n      apiKey: config.apiKey,\r\n      apiUrl: config.apiUrl || 'http://localhost:4000',\r\n      position: config.position || 'bottom-right',\r\n      primaryColor: config.primaryColor || '#E2725B',\r\n      welcomeMessage: config.welcomeMessage || 'Hello! How can I help you today?',\r\n      botName: config.botName || 'Botari Assistant',\r\n      businessName: config.businessName || 'Botari AI',\r\n      placeholder: config.placeholder || 'Type a message...',\r\n      autoOpen: config.autoOpen || 0,\r\n      soundEnabled: config.soundEnabled !== false,\r\n      customClass: config.customClass || '',\r\n    };\r\n\r\n    this.api = new BotariAPI(this.config);\r\n    this.storageKey = `botari_widget_${this.config.businessId}`;\r\n\r\n    // Restore saved state\r\n    this.restoreState();\r\n  }\r\n\r\n  /**\r\n   * Initialize the widget - create DOM elements and attach events\r\n   */\r\n  init(): void {\r\n    if (this.container) {\r\n      console.warn('BotariWidget: Already initialized');\r\n      return;\r\n    }\r\n\r\n    this.createDOM();\r\n    this.attachEvents();\r\n    this.applyCustomStyles();\r\n\r\n    // Auto-open if configured\r\n    if (this.config.autoOpen > 0) {\r\n      this.autoOpenTimer = window.setTimeout(() => {\r\n        this.open();\r\n      }, this.config.autoOpen);\r\n    }\r\n\r\n    // Create or restore conversation\r\n    this.initializeConversation();\r\n  }\r\n\r\n  /**\r\n   * Create all DOM elements\r\n   */\r\n  private createDOM(): void {\r\n    // Main container\r\n    this.container = document.createElement('div');\r\n    this.container.className = `botari-widget botari-widget--${this.config.position} ${this.config.customClass}`;\r\n    this.container.setAttribute('role', 'region');\r\n    this.container.setAttribute('aria-label', 'Botari Chat Widget');\r\n\r\n    // Chat button\r\n    this.button = document.createElement('button');\r\n    this.button.className = 'botari-widget__button';\r\n    this.button.setAttribute('aria-label', 'Open chat');\r\n    this.button.innerHTML = ICONS.chat;\r\n    this.container.appendChild(this.button);\r\n\r\n    // Chat window\r\n    this.window = document.createElement('div');\r\n    this.window.className = 'botari-widget__window';\r\n    this.window.setAttribute('role', 'dialog');\r\n    this.window.setAttribute('aria-label', 'Chat with us');\r\n\r\n    // Header\r\n    const header = document.createElement('div');\r\n    header.className = 'botari-widget__header';\r\n    header.innerHTML = `\r\n      <div class=\"botari-widget__header-info\">\r\n        <div class=\"botari-widget__avatar\">${this.config.botName.charAt(0)}</div>\r\n        <div class=\"botari-widget__header-text\">\r\n          <h3 class=\"botari-widget__bot-name\">${this.config.botName}</h3>\r\n          <span class=\"botari-widget__status\">\r\n            <span class=\"botari-widget__status-dot\"></span>\r\n            Online\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <div class=\"botari-widget__header-actions\">\r\n        <button class=\"botari-widget__header-btn\" data-action=\"clear\" title=\"Clear chat\" aria-label=\"Clear chat\">\r\n          ${ICONS.clear}\r\n        </button>\r\n        <button class=\"botari-widget__header-btn\" data-action=\"close\" title=\"Close chat\" aria-label=\"Close chat\">\r\n          ${ICONS.close}\r\n        </button>\r\n      </div>\r\n    `;\r\n    this.window.appendChild(header);\r\n\r\n    // Messages container\r\n    this.messagesContainer = document.createElement('div');\r\n    this.messagesContainer.className = 'botari-widget__messages';\r\n    this.window.appendChild(this.messagesContainer);\r\n\r\n    // Input area\r\n    const inputArea = document.createElement('div');\r\n    inputArea.className = 'botari-widget__input-area';\r\n    inputArea.innerHTML = `\r\n      <textarea \r\n        class=\"botari-widget__input\" \r\n        placeholder=\"${this.config.placeholder}\"\r\n        rows=\"1\"\r\n        aria-label=\"Message\"\r\n      ></textarea>\r\n      <button class=\"botari-widget__send-btn\" aria-label=\"Send message\">\r\n        ${ICONS.send}\r\n      </button>\r\n    `;\r\n    this.window.appendChild(inputArea);\r\n\r\n    // Powered by\r\n    const powered = document.createElement('div');\r\n    powered.className = 'botari-widget__powered';\r\n    powered.innerHTML = `Powered by <a href=\"https://botari.ai\" target=\"_blank\" rel=\"noopener\">${this.config.businessName}</a>`;\r\n    this.window.appendChild(powered);\r\n\r\n    this.container.appendChild(this.window);\r\n\r\n    // Store references\r\n    this.input = inputArea.querySelector('.botari-widget__input') as HTMLTextAreaElement;\r\n\r\n    // Append to body\r\n    document.body.appendChild(this.container);\r\n\r\n    // Show welcome message\r\n    this.showWelcomeMessage();\r\n  }\r\n\r\n  /**\r\n   * Attach event listeners\r\n   */\r\n  private attachEvents(): void {\r\n    if (!this.button || !this.window || !this.input) return;\r\n\r\n    // Toggle button click\r\n    this.button.addEventListener('click', () => this.toggle());\r\n\r\n    // Header button clicks\r\n    this.window.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      const btn = target.closest('[data-action]') as HTMLButtonElement;\r\n      if (btn) {\r\n        const action = btn.getAttribute('data-action');\r\n        if (action === 'close') this.close();\r\n        if (action === 'clear') this.clear();\r\n      }\r\n    });\r\n\r\n    // Send button click\r\n    const sendBtn = this.window.querySelector('.botari-widget__send-btn') as HTMLButtonElement;\r\n    sendBtn.addEventListener('click', () => this.handleSend());\r\n\r\n    // Input keypress (Enter to send, Shift+Enter for new line)\r\n    this.input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        this.handleSend();\r\n      }\r\n    });\r\n\r\n    // Auto-resize textarea\r\n    this.input.addEventListener('input', () => {\r\n      this.input!.style.height = 'auto';\r\n      this.input!.style.height = Math.min(this.input!.scrollHeight, 120) + 'px';\r\n    });\r\n\r\n    // Click outside to close\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (this.state === 'open' && \r\n          !this.window!.contains(target) && \r\n          !this.button!.contains(target)) {\r\n        this.close();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Apply custom primary color\r\n   */\r\n  private applyCustomStyles(): void {\r\n    if (this.config.primaryColor !== '#E2725B' && this.container) {\r\n      this.container.style.setProperty('--botari-primary', this.config.primaryColor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show welcome message\r\n   */\r\n  private showWelcomeMessage(): void {\r\n    if (this.messages.length === 0) {\r\n      this.addMessage({\r\n        id: 'welcome',\r\n        conversation_id: 0,\r\n        sender: 'bot',\r\n        text: this.config.welcomeMessage,\r\n        created_at: new Date().toISOString(),\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize or restore conversation\r\n   */\r\n  private async initializeConversation(): Promise<void> {\r\n    try {\r\n      // Try to restore from storage\r\n      const savedConversationId = localStorage.getItem(`${this.storageKey}_conversation_id`);\r\n      if (savedConversationId) {\r\n        this.api.setConversationId(parseInt(savedConversationId, 10));\r\n        // TODO: Load message history when endpoint is available\r\n      } else {\r\n        // Create new conversation\r\n        const conversationId = await this.api.createConversation({\r\n          name: this.customerName,\r\n        });\r\n        localStorage.setItem(`${this.storageKey}_conversation_id`, String(conversationId));\r\n      }\r\n    } catch (error) {\r\n      console.error('BotariWidget: Failed to initialize conversation', error);\r\n      this.showError('Failed to start conversation. Please try again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle sending a message\r\n   */\r\n  private async handleSend(): Promise<void> {\r\n    if (!this.input || this.isTyping) return;\r\n\r\n    const text = this.input.value.trim();\r\n    if (!text) return;\r\n\r\n    // Clear input\r\n    this.input.value = '';\r\n    this.input.style.height = 'auto';\r\n\r\n    await this.sendMessage(text);\r\n  }\r\n\r\n  /**\r\n   * Send a message\r\n   */\r\n  async sendMessage(text: string): Promise<void> {\r\n    // Add user message to UI\r\n    this.addMessage({\r\n      id: Date.now().toString(),\r\n      conversation_id: this.api.getConversationId() || 0,\r\n      sender: 'user',\r\n      text,\r\n      created_at: new Date().toISOString(),\r\n    });\r\n\r\n    // Show typing indicator\r\n    this.showTypingIndicator();\r\n\r\n    try {\r\n      // Send to API\r\n      const reply = await this.api.sendMessage(text, 'user');\r\n\r\n      // Hide typing indicator\r\n      this.hideTypingIndicator();\r\n\r\n      // Add bot response\r\n      this.addMessage({\r\n        id: (Date.now() + 1).toString(),\r\n        conversation_id: this.api.getConversationId() || 0,\r\n        sender: 'bot',\r\n        text: reply,\r\n        created_at: new Date().toISOString(),\r\n      });\r\n\r\n      // Play sound if enabled\r\n      if (this.config.soundEnabled) {\r\n        this.playNotificationSound();\r\n      }\r\n    } catch (error) {\r\n      this.hideTypingIndicator();\r\n      console.error('BotariWidget: Failed to send message', error);\r\n      this.showError('Failed to send message. Please try again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a message to the UI\r\n   */\r\n  private addMessage(message: Message): void {\r\n    this.messages.push(message);\r\n\r\n    if (!this.messagesContainer) return;\r\n\r\n    const isBot = message.sender === 'bot' || message.sender === 'botari';\r\n    const messageEl = document.createElement('div');\r\n    messageEl.className = `botari-widget__message botari-widget__message--${isBot ? 'bot' : 'user'}`;\r\n\r\n    const avatar = isBot ? 'ðŸ¤–' : ICONS.user;\r\n    const time = new Date(message.created_at).toLocaleTimeString([], {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n\r\n    messageEl.innerHTML = `\r\n      <div class=\"botari-widget__message-avatar\">\r\n        ${isBot ? avatar : '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"width:16px;height:16px\"><path d=\"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/></svg>'}\r\n      </div>\r\n      <div class=\"botari-widget__message-content\">\r\n        <div class=\"botari-widget__message-bubble\">${this.escapeHtml(message.text)}</div>\r\n        <span class=\"botari-widget__message-time\">${time}</span>\r\n      </div>\r\n    `;\r\n\r\n    this.messagesContainer.appendChild(messageEl);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Show typing indicator\r\n   */\r\n  private showTypingIndicator(): void {\r\n    this.isTyping = true;\r\n    if (!this.messagesContainer) return;\r\n\r\n    const indicator = document.createElement('div');\r\n    indicator.className = 'botari-widget__typing';\r\n    indicator.id = 'botari-typing-indicator';\r\n    indicator.innerHTML = `\r\n      <div class=\"botari-widget__message-avatar\">ðŸ¤–</div>\r\n      <div class=\"botari-widget__typing-dots\">\r\n        <span class=\"botari-widget__typing-dot\"></span>\r\n        <span class=\"botari-widget__typing-dot\"></span>\r\n        <span class=\"botari-widget__typing-dot\"></span>\r\n      </div>\r\n    `;\r\n\r\n    this.messagesContainer.appendChild(indicator);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Hide typing indicator\r\n   */\r\n  private hideTypingIndicator(): void {\r\n    this.isTyping = false;\r\n    const indicator = document.getElementById('botari-typing-indicator');\r\n    if (indicator) {\r\n      indicator.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error message\r\n   */\r\n  private showError(message: string): void {\r\n    if (!this.messagesContainer) return;\r\n\r\n    const errorEl = document.createElement('div');\r\n    errorEl.className = 'botari-widget__error';\r\n    errorEl.textContent = message;\r\n\r\n    this.messagesContainer.appendChild(errorEl);\r\n    this.scrollToBottom();\r\n\r\n    // Auto-remove after 5 seconds\r\n    setTimeout(() => errorEl.remove(), 5000);\r\n  }\r\n\r\n  /**\r\n   * Scroll messages to bottom\r\n   */\r\n  private scrollToBottom(): void {\r\n    if (this.messagesContainer) {\r\n      this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Escape HTML to prevent XSS\r\n   */\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Play notification sound\r\n   */\r\n  private playNotificationSound(): void {\r\n    // Create a simple beep sound\r\n    try {\r\n      const audioCtx = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      const oscillator = audioCtx.createOscillator();\r\n      const gainNode = audioCtx.createGain();\r\n\r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(audioCtx.destination);\r\n\r\n      oscillator.frequency.value = 800;\r\n      oscillator.type = 'sine';\r\n      gainNode.gain.value = 0.1;\r\n\r\n      oscillator.start();\r\n      oscillator.stop(audioCtx.currentTime + 0.1);\r\n    } catch {\r\n      // Audio not supported, ignore\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore state from storage\r\n   */\r\n  private restoreState(): void {\r\n    const savedName = localStorage.getItem(`${this.storageKey}_customer_name`);\r\n    if (savedName) {\r\n      this.customerName = savedName;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save state to storage\r\n   */\r\n  private saveState(): void {\r\n    localStorage.setItem(`${this.storageKey}_customer_name`, this.customerName);\r\n  }\r\n\r\n  // Public API methods\r\n\r\n  open(): void {\r\n    if (this.state === 'open' || !this.window || !this.button) return;\r\n    \r\n    this.state = 'open';\r\n    this.window.classList.add('botari-widget__window--open');\r\n    this.button.innerHTML = ICONS.close;\r\n    this.button.setAttribute('aria-label', 'Close chat');\r\n    \r\n    // Focus input\r\n    if (this.input) {\r\n      setTimeout(() => this.input?.focus(), 100);\r\n    }\r\n\r\n    this.saveState();\r\n  }\r\n\r\n  close(): void {\r\n    if (this.state === 'closed' || !this.window || !this.button) return;\r\n    \r\n    this.state = 'closed';\r\n    this.window.classList.remove('botari-widget__window--open');\r\n    this.button.innerHTML = ICONS.chat;\r\n    this.button.setAttribute('aria-label', 'Open chat');\r\n\r\n    this.saveState();\r\n  }\r\n\r\n  toggle(): void {\r\n    if (this.state === 'open') {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.messages = [];\r\n    if (this.messagesContainer) {\r\n      this.messagesContainer.innerHTML = '';\r\n    }\r\n    this.showWelcomeMessage();\r\n    \r\n    // Clear conversation ID to start fresh\r\n    localStorage.removeItem(`${this.storageKey}_conversation_id`);\r\n    this.initializeConversation();\r\n  }\r\n\r\n  destroy(): void {\r\n    // Clear auto-open timer\r\n    if (this.autoOpenTimer) {\r\n      clearTimeout(this.autoOpenTimer);\r\n    }\r\n\r\n    // Close conversation\r\n    this.api.closeConversation();\r\n\r\n    // Remove from DOM\r\n    if (this.container) {\r\n      this.container.remove();\r\n    }\r\n\r\n    // Clear references\r\n    this.container = null;\r\n    this.button = null;\r\n    this.window = null;\r\n    this.messagesContainer = null;\r\n    this.input = null;\r\n  }\r\n}\r\n\r\nexport default ChatWidget;\r\n","/**\r\n * Botari Widget - Embeddable Chat Widget\r\n * Main entry point for the library\r\n * \r\n * Usage:\r\n * <script src=\"botari-widget.min.js\"></script>\r\n * <script>\r\n *   BotariWidget.init({\r\n *     businessId: '123',\r\n *     apiKey: 'your-api-key',\r\n *     botName: 'Amina',\r\n *     welcomeMessage: 'Hi! How can I help you today?'\r\n *   });\r\n * </script>\r\n */\r\n\r\nimport type { WidgetConfig, WidgetInstance } from './types';\r\nimport { ChatWidget } from './ChatWidget';\r\nimport './styles.css';\r\n\r\n// Store widget instances\r\nconst instances: Map<string, WidgetInstance> = new Map();\r\n\r\n/**\r\n * Initialize a new Botari Widget instance\r\n * @param config - Widget configuration\r\n * @returns Widget instance with control methods\r\n */\r\nexport function init(config: WidgetConfig): WidgetInstance {\r\n  const instanceId = `${config.businessId}_${Date.now()}`;\r\n  \r\n  const widget = new ChatWidget(config);\r\n  widget.init();\r\n  \r\n  instances.set(instanceId, widget);\r\n  \r\n  // Store reference on window for global access\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__botariWidget = widget;\r\n  }\r\n  \r\n  return widget;\r\n}\r\n\r\n/**\r\n * Get the most recently created widget instance\r\n * @returns The last widget instance or undefined\r\n */\r\nexport function getInstance(): WidgetInstance | undefined {\r\n  const values = Array.from(instances.values());\r\n  return values[values.length - 1];\r\n}\r\n\r\n/**\r\n * Destroy all widget instances\r\n */\r\nexport function destroyAll(): void {\r\n  instances.forEach((instance) => instance.destroy());\r\n  instances.clear();\r\n  \r\n  if (typeof window !== 'undefined') {\r\n    delete (window as any).__botariWidget;\r\n  }\r\n}\r\n\r\n/**\r\n * Version of the widget\r\n */\r\nexport const version = '1.0.0';\r\n\r\n// Default export for UMD build\r\nconst BotariWidget = {\r\n  init,\r\n  getInstance,\r\n  destroyAll,\r\n  version,\r\n};\r\n\r\n// Export for ES modules\r\nexport default BotariWidget;\r\n\r\n// Auto-initialize if config is present in window\r\nif (typeof window !== 'undefined') {\r\n  const w = window as any;\r\n  \r\n  // Expose to window for UMD\r\n  w.BotariWidget = BotariWidget;\r\n  \r\n  // Auto-init if config is present\r\n  if (w.BOTARI_WIDGET_CONFIG) {\r\n    if (document.readyState === 'loading') {\r\n      document.addEventListener('DOMContentLoaded', () => {\r\n        init(w.BOTARI_WIDGET_CONFIG);\r\n      });\r\n    } else {\r\n      init(w.BOTARI_WIDGET_CONFIG);\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}