{"version":3,"file":"botari-widget.js","sources":["../src/api.ts","../src/ChatWidget.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Botari Widget API Client\r\n * Handles all communication with the Botari backend\r\n */\r\n\r\nimport type { \r\n  WidgetConfig, \r\n  Conversation, \r\n  Message, \r\n  CreateConversationResponse, \r\n  SendMessageResponse \r\n} from './types';\r\n\r\nexport class BotariAPI {\r\n  private config: Required<Pick<WidgetConfig, 'apiUrl' | 'apiKey' | 'businessId'>>;\r\n  private conversationId: number | null = null;\r\n\r\n  constructor(config: WidgetConfig) {\r\n    this.config = {\r\n      apiUrl: config.apiUrl || 'http://localhost:4000',\r\n      apiKey: config.apiKey,\r\n      businessId: config.businessId,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the current conversation ID\r\n   */\r\n  getConversationId(): number | null {\r\n    return this.conversationId;\r\n  }\r\n\r\n  /**\r\n   * Set conversation ID (used when restoring from storage)\r\n   */\r\n  setConversationId(id: number): void {\r\n    this.conversationId = id;\r\n  }\r\n\r\n  /**\r\n   * Create headers for API requests\r\n   */\r\n  private getHeaders(): Record<string, string> {\r\n    return {\r\n      'Content-Type': 'application/json',\r\n      'X-API-Key': this.config.apiKey,\r\n      'X-Business-ID': String(this.config.businessId),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a new conversation\r\n   */\r\n  async createConversation(customerInfo?: { name?: string; phone?: string }): Promise<number> {\r\n    const response = await fetch(`${this.config.apiUrl}/api/conversations`, {\r\n      method: 'POST',\r\n      headers: this.getHeaders(),\r\n      body: JSON.stringify({\r\n        customer_name: customerInfo?.name || 'Website Visitor',\r\n        customer_phone: customerInfo?.phone || '',\r\n        employee_id: 1, // Default AI employee\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n      throw new Error(error.error || `Failed to create conversation: ${response.status}`);\r\n    }\r\n\r\n    const data: CreateConversationResponse = await response.json();\r\n    this.conversationId = data.conversation_id;\r\n    return data.conversation_id;\r\n  }\r\n\r\n  /**\r\n   * Get messages for the current conversation\r\n   */\r\n  async getMessages(conversationId?: number): Promise<Message[]> {\r\n    const id = conversationId || this.conversationId;\r\n    if (!id) {\r\n      throw new Error('No conversation ID available');\r\n    }\r\n\r\n    const response = await fetch(\r\n      `${this.config.apiUrl}/api/conversations/${id}/messages`,\r\n      {\r\n        method: 'GET',\r\n        headers: this.getHeaders(),\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n      throw new Error(error.error || `Failed to get messages: ${response.status}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Send a message and get AI response\r\n   */\r\n  async sendMessage(text: string, sender: string = 'user'): Promise<string> {\r\n    if (!this.conversationId) {\r\n      await this.createConversation();\r\n    }\r\n\r\n    const response = await fetch(`${this.config.apiUrl}/api/messages`, {\r\n      method: 'POST',\r\n      headers: this.getHeaders(),\r\n      body: JSON.stringify({\r\n        conversation_id: this.conversationId,\r\n        sender,\r\n        text,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n      throw new Error(error.error || `Failed to send message: ${response.status}`);\r\n    }\r\n\r\n    const data: SendMessageResponse = await response.json();\r\n    return data.reply;\r\n  }\r\n\r\n  /**\r\n   * Close the current conversation\r\n   */\r\n  async closeConversation(conversationId?: number): Promise<void> {\r\n    const id = conversationId || this.conversationId;\r\n    if (!id) return;\r\n\r\n    const response = await fetch(\r\n      `${this.config.apiUrl}/api/conversations/${id}/close`,\r\n      {\r\n        method: 'PUT',\r\n        headers: this.getHeaders(),\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      console.error('Failed to close conversation');\r\n    }\r\n\r\n    this.conversationId = null;\r\n  }\r\n\r\n  /**\r\n   * Check if API is reachable\r\n   */\r\n  async healthCheck(): Promise<boolean> {\r\n    try {\r\n      const response = await fetch(`${this.config.apiUrl}/health`, {\r\n        method: 'GET',\r\n        headers: { 'X-API-Key': this.config.apiKey },\r\n      });\r\n      return response.ok;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default BotariAPI;\r\n","/**\r\n * Botari Chat Widget\r\n * Main widget class that handles UI and interactions\r\n */\r\n\r\nimport type { WidgetConfig, WidgetInstance, Message, WidgetState } from './types';\r\nimport { BotariAPI } from './api';\r\n\r\n// SVG Icons\r\nconst ICONS = {\r\n  chat: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z\"/></svg>`,\r\n  close: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>`,\r\n  send: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m22 2-7 20-4-9-9-4z\"/><path d=\"M22 2 11 13\"/></svg>`,\r\n  minimize: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M4 14h6v6\"/><path d=\"M20 10h-6V4\"/><path d=\"M14 10 4 20\"/><path d=\"m20 4-10 10\"/></svg>`,\r\n  clear: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 6h18\"/><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/></svg>`,\r\n  bot: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 8V4H8\"/><rect width=\"16\" height=\"12\" x=\"4\" y=\"8\" rx=\"2\"/><path d=\"M2 14h2\"/><path d=\"M20 14h2\"/><path d=\"M15 13v2\"/><path d=\"M9 13v2\"/></svg>`,\r\n  user: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/></svg>`,\r\n};\r\n\r\nexport class ChatWidget implements WidgetInstance {\r\n  private config: Required<WidgetConfig>;\r\n  private api: BotariAPI;\r\n  private state: WidgetState = 'closed';\r\n  private messages: Message[] = [];\r\n  private container: HTMLElement | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private window: HTMLElement | null = null;\r\n  private messagesContainer: HTMLElement | null = null;\r\n  private input: HTMLTextAreaElement | null = null;\r\n  private isTyping = false;\r\n  private autoOpenTimer: number | null = null;\r\n  private storageKey: string;\r\n  private customerName: string = 'You';\r\n\r\n  constructor(config: WidgetConfig) {\r\n    // Validate required config\r\n    if (!config.businessId) {\r\n      throw new Error('BotariWidget: businessId is required');\r\n    }\r\n    if (!config.apiKey) {\r\n      throw new Error('BotariWidget: apiKey is required');\r\n    }\r\n\r\n    // Set default config\r\n    this.config = {\r\n      businessId: config.businessId,\r\n      apiKey: config.apiKey,\r\n      apiUrl: config.apiUrl || 'http://localhost:4000',\r\n      position: config.position || 'bottom-right',\r\n      primaryColor: config.primaryColor || '#E2725B',\r\n      welcomeMessage: config.welcomeMessage || 'Hello! How can I help you today?',\r\n      botName: config.botName || 'Botari Assistant',\r\n      businessName: config.businessName || 'Botari AI',\r\n      placeholder: config.placeholder || 'Type a message...',\r\n      autoOpen: config.autoOpen || 0,\r\n      soundEnabled: config.soundEnabled !== false,\r\n      customClass: config.customClass || '',\r\n    };\r\n\r\n    this.api = new BotariAPI(this.config);\r\n    this.storageKey = `botari_widget_${this.config.businessId}`;\r\n\r\n    // Restore saved state\r\n    this.restoreState();\r\n  }\r\n\r\n  /**\r\n   * Initialize the widget - create DOM elements and attach events\r\n   */\r\n  init(): void {\r\n    if (this.container) {\r\n      console.warn('BotariWidget: Already initialized');\r\n      return;\r\n    }\r\n\r\n    this.createDOM();\r\n    this.attachEvents();\r\n    this.applyCustomStyles();\r\n\r\n    // Auto-open if configured\r\n    if (this.config.autoOpen > 0) {\r\n      this.autoOpenTimer = window.setTimeout(() => {\r\n        this.open();\r\n      }, this.config.autoOpen);\r\n    }\r\n\r\n    // Create or restore conversation\r\n    this.initializeConversation();\r\n  }\r\n\r\n  /**\r\n   * Create all DOM elements\r\n   */\r\n  private createDOM(): void {\r\n    // Main container\r\n    this.container = document.createElement('div');\r\n    this.container.className = `botari-widget botari-widget--${this.config.position} ${this.config.customClass}`;\r\n    this.container.setAttribute('role', 'region');\r\n    this.container.setAttribute('aria-label', 'Botari Chat Widget');\r\n\r\n    // Chat button\r\n    this.button = document.createElement('button');\r\n    this.button.className = 'botari-widget__button';\r\n    this.button.setAttribute('aria-label', 'Open chat');\r\n    this.button.innerHTML = ICONS.chat;\r\n    this.container.appendChild(this.button);\r\n\r\n    // Chat window\r\n    this.window = document.createElement('div');\r\n    this.window.className = 'botari-widget__window';\r\n    this.window.setAttribute('role', 'dialog');\r\n    this.window.setAttribute('aria-label', 'Chat with us');\r\n\r\n    // Header\r\n    const header = document.createElement('div');\r\n    header.className = 'botari-widget__header';\r\n    header.innerHTML = `\r\n      <div class=\"botari-widget__header-info\">\r\n        <div class=\"botari-widget__avatar\">${this.config.botName.charAt(0)}</div>\r\n        <div class=\"botari-widget__header-text\">\r\n          <h3 class=\"botari-widget__bot-name\">${this.config.botName}</h3>\r\n          <span class=\"botari-widget__status\">\r\n            <span class=\"botari-widget__status-dot\"></span>\r\n            Online\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <div class=\"botari-widget__header-actions\">\r\n        <button class=\"botari-widget__header-btn\" data-action=\"clear\" title=\"Clear chat\" aria-label=\"Clear chat\">\r\n          ${ICONS.clear}\r\n        </button>\r\n        <button class=\"botari-widget__header-btn\" data-action=\"close\" title=\"Close chat\" aria-label=\"Close chat\">\r\n          ${ICONS.close}\r\n        </button>\r\n      </div>\r\n    `;\r\n    this.window.appendChild(header);\r\n\r\n    // Messages container\r\n    this.messagesContainer = document.createElement('div');\r\n    this.messagesContainer.className = 'botari-widget__messages';\r\n    this.window.appendChild(this.messagesContainer);\r\n\r\n    // Input area\r\n    const inputArea = document.createElement('div');\r\n    inputArea.className = 'botari-widget__input-area';\r\n    inputArea.innerHTML = `\r\n      <textarea \r\n        class=\"botari-widget__input\" \r\n        placeholder=\"${this.config.placeholder}\"\r\n        rows=\"1\"\r\n        aria-label=\"Message\"\r\n      ></textarea>\r\n      <button class=\"botari-widget__send-btn\" aria-label=\"Send message\">\r\n        ${ICONS.send}\r\n      </button>\r\n    `;\r\n    this.window.appendChild(inputArea);\r\n\r\n    // Powered by\r\n    const powered = document.createElement('div');\r\n    powered.className = 'botari-widget__powered';\r\n    powered.innerHTML = `Powered by <a href=\"https://botari.ai\" target=\"_blank\" rel=\"noopener\">${this.config.businessName}</a>`;\r\n    this.window.appendChild(powered);\r\n\r\n    this.container.appendChild(this.window);\r\n\r\n    // Store references\r\n    this.input = inputArea.querySelector('.botari-widget__input') as HTMLTextAreaElement;\r\n\r\n    // Append to body\r\n    document.body.appendChild(this.container);\r\n\r\n    // Show welcome message\r\n    this.showWelcomeMessage();\r\n  }\r\n\r\n  /**\r\n   * Attach event listeners\r\n   */\r\n  private attachEvents(): void {\r\n    if (!this.button || !this.window || !this.input) return;\r\n\r\n    // Toggle button click\r\n    this.button.addEventListener('click', () => this.toggle());\r\n\r\n    // Header button clicks\r\n    this.window.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      const btn = target.closest('[data-action]') as HTMLButtonElement;\r\n      if (btn) {\r\n        const action = btn.getAttribute('data-action');\r\n        if (action === 'close') this.close();\r\n        if (action === 'clear') this.clear();\r\n      }\r\n    });\r\n\r\n    // Send button click\r\n    const sendBtn = this.window.querySelector('.botari-widget__send-btn') as HTMLButtonElement;\r\n    sendBtn.addEventListener('click', () => this.handleSend());\r\n\r\n    // Input keypress (Enter to send, Shift+Enter for new line)\r\n    this.input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        this.handleSend();\r\n      }\r\n    });\r\n\r\n    // Auto-resize textarea\r\n    this.input.addEventListener('input', () => {\r\n      this.input!.style.height = 'auto';\r\n      this.input!.style.height = Math.min(this.input!.scrollHeight, 120) + 'px';\r\n    });\r\n\r\n    // Click outside to close\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (this.state === 'open' && \r\n          !this.window!.contains(target) && \r\n          !this.button!.contains(target)) {\r\n        this.close();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Apply custom primary color\r\n   */\r\n  private applyCustomStyles(): void {\r\n    if (this.config.primaryColor !== '#E2725B' && this.container) {\r\n      this.container.style.setProperty('--botari-primary', this.config.primaryColor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show welcome message\r\n   */\r\n  private showWelcomeMessage(): void {\r\n    if (this.messages.length === 0) {\r\n      this.addMessage({\r\n        id: 'welcome',\r\n        conversation_id: 0,\r\n        sender: 'bot',\r\n        text: this.config.welcomeMessage,\r\n        created_at: new Date().toISOString(),\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize or restore conversation\r\n   */\r\n  private async initializeConversation(): Promise<void> {\r\n    try {\r\n      // Try to restore from storage\r\n      const savedConversationId = localStorage.getItem(`${this.storageKey}_conversation_id`);\r\n      if (savedConversationId) {\r\n        this.api.setConversationId(parseInt(savedConversationId, 10));\r\n        // TODO: Load message history when endpoint is available\r\n      } else {\r\n        // Create new conversation\r\n        const conversationId = await this.api.createConversation({\r\n          name: this.customerName,\r\n        });\r\n        localStorage.setItem(`${this.storageKey}_conversation_id`, String(conversationId));\r\n      }\r\n    } catch (error) {\r\n      console.error('BotariWidget: Failed to initialize conversation', error);\r\n      this.showError('Failed to start conversation. Please try again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle sending a message\r\n   */\r\n  private async handleSend(): Promise<void> {\r\n    if (!this.input || this.isTyping) return;\r\n\r\n    const text = this.input.value.trim();\r\n    if (!text) return;\r\n\r\n    // Clear input\r\n    this.input.value = '';\r\n    this.input.style.height = 'auto';\r\n\r\n    await this.sendMessage(text);\r\n  }\r\n\r\n  /**\r\n   * Send a message\r\n   */\r\n  async sendMessage(text: string): Promise<void> {\r\n    // Add user message to UI\r\n    this.addMessage({\r\n      id: Date.now().toString(),\r\n      conversation_id: this.api.getConversationId() || 0,\r\n      sender: 'user',\r\n      text,\r\n      created_at: new Date().toISOString(),\r\n    });\r\n\r\n    // Show typing indicator\r\n    this.showTypingIndicator();\r\n\r\n    try {\r\n      // Send to API\r\n      const reply = await this.api.sendMessage(text, 'user');\r\n\r\n      // Hide typing indicator\r\n      this.hideTypingIndicator();\r\n\r\n      // Add bot response\r\n      this.addMessage({\r\n        id: (Date.now() + 1).toString(),\r\n        conversation_id: this.api.getConversationId() || 0,\r\n        sender: 'bot',\r\n        text: reply,\r\n        created_at: new Date().toISOString(),\r\n      });\r\n\r\n      // Play sound if enabled\r\n      if (this.config.soundEnabled) {\r\n        this.playNotificationSound();\r\n      }\r\n    } catch (error) {\r\n      this.hideTypingIndicator();\r\n      console.error('BotariWidget: Failed to send message', error);\r\n      this.showError('Failed to send message. Please try again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a message to the UI\r\n   */\r\n  private addMessage(message: Message): void {\r\n    this.messages.push(message);\r\n\r\n    if (!this.messagesContainer) return;\r\n\r\n    const isBot = message.sender === 'bot' || message.sender === 'botari';\r\n    const messageEl = document.createElement('div');\r\n    messageEl.className = `botari-widget__message botari-widget__message--${isBot ? 'bot' : 'user'}`;\r\n\r\n    const avatar = isBot ? 'ðŸ¤–' : ICONS.user;\r\n    const time = new Date(message.created_at).toLocaleTimeString([], {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n\r\n    messageEl.innerHTML = `\r\n      <div class=\"botari-widget__message-avatar\">\r\n        ${isBot ? avatar : '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"width:16px;height:16px\"><path d=\"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/></svg>'}\r\n      </div>\r\n      <div class=\"botari-widget__message-content\">\r\n        <div class=\"botari-widget__message-bubble\">${this.escapeHtml(message.text)}</div>\r\n        <span class=\"botari-widget__message-time\">${time}</span>\r\n      </div>\r\n    `;\r\n\r\n    this.messagesContainer.appendChild(messageEl);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Show typing indicator\r\n   */\r\n  private showTypingIndicator(): void {\r\n    this.isTyping = true;\r\n    if (!this.messagesContainer) return;\r\n\r\n    const indicator = document.createElement('div');\r\n    indicator.className = 'botari-widget__typing';\r\n    indicator.id = 'botari-typing-indicator';\r\n    indicator.innerHTML = `\r\n      <div class=\"botari-widget__message-avatar\">ðŸ¤–</div>\r\n      <div class=\"botari-widget__typing-dots\">\r\n        <span class=\"botari-widget__typing-dot\"></span>\r\n        <span class=\"botari-widget__typing-dot\"></span>\r\n        <span class=\"botari-widget__typing-dot\"></span>\r\n      </div>\r\n    `;\r\n\r\n    this.messagesContainer.appendChild(indicator);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Hide typing indicator\r\n   */\r\n  private hideTypingIndicator(): void {\r\n    this.isTyping = false;\r\n    const indicator = document.getElementById('botari-typing-indicator');\r\n    if (indicator) {\r\n      indicator.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error message\r\n   */\r\n  private showError(message: string): void {\r\n    if (!this.messagesContainer) return;\r\n\r\n    const errorEl = document.createElement('div');\r\n    errorEl.className = 'botari-widget__error';\r\n    errorEl.textContent = message;\r\n\r\n    this.messagesContainer.appendChild(errorEl);\r\n    this.scrollToBottom();\r\n\r\n    // Auto-remove after 5 seconds\r\n    setTimeout(() => errorEl.remove(), 5000);\r\n  }\r\n\r\n  /**\r\n   * Scroll messages to bottom\r\n   */\r\n  private scrollToBottom(): void {\r\n    if (this.messagesContainer) {\r\n      this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Escape HTML to prevent XSS\r\n   */\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Play notification sound\r\n   */\r\n  private playNotificationSound(): void {\r\n    // Create a simple beep sound\r\n    try {\r\n      const audioCtx = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      const oscillator = audioCtx.createOscillator();\r\n      const gainNode = audioCtx.createGain();\r\n\r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(audioCtx.destination);\r\n\r\n      oscillator.frequency.value = 800;\r\n      oscillator.type = 'sine';\r\n      gainNode.gain.value = 0.1;\r\n\r\n      oscillator.start();\r\n      oscillator.stop(audioCtx.currentTime + 0.1);\r\n    } catch {\r\n      // Audio not supported, ignore\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore state from storage\r\n   */\r\n  private restoreState(): void {\r\n    const savedName = localStorage.getItem(`${this.storageKey}_customer_name`);\r\n    if (savedName) {\r\n      this.customerName = savedName;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save state to storage\r\n   */\r\n  private saveState(): void {\r\n    localStorage.setItem(`${this.storageKey}_customer_name`, this.customerName);\r\n  }\r\n\r\n  // Public API methods\r\n\r\n  open(): void {\r\n    if (this.state === 'open' || !this.window || !this.button) return;\r\n    \r\n    this.state = 'open';\r\n    this.window.classList.add('botari-widget__window--open');\r\n    this.button.innerHTML = ICONS.close;\r\n    this.button.setAttribute('aria-label', 'Close chat');\r\n    \r\n    // Focus input\r\n    if (this.input) {\r\n      setTimeout(() => this.input?.focus(), 100);\r\n    }\r\n\r\n    this.saveState();\r\n  }\r\n\r\n  close(): void {\r\n    if (this.state === 'closed' || !this.window || !this.button) return;\r\n    \r\n    this.state = 'closed';\r\n    this.window.classList.remove('botari-widget__window--open');\r\n    this.button.innerHTML = ICONS.chat;\r\n    this.button.setAttribute('aria-label', 'Open chat');\r\n\r\n    this.saveState();\r\n  }\r\n\r\n  toggle(): void {\r\n    if (this.state === 'open') {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.messages = [];\r\n    if (this.messagesContainer) {\r\n      this.messagesContainer.innerHTML = '';\r\n    }\r\n    this.showWelcomeMessage();\r\n    \r\n    // Clear conversation ID to start fresh\r\n    localStorage.removeItem(`${this.storageKey}_conversation_id`);\r\n    this.initializeConversation();\r\n  }\r\n\r\n  destroy(): void {\r\n    // Clear auto-open timer\r\n    if (this.autoOpenTimer) {\r\n      clearTimeout(this.autoOpenTimer);\r\n    }\r\n\r\n    // Close conversation\r\n    this.api.closeConversation();\r\n\r\n    // Remove from DOM\r\n    if (this.container) {\r\n      this.container.remove();\r\n    }\r\n\r\n    // Clear references\r\n    this.container = null;\r\n    this.button = null;\r\n    this.window = null;\r\n    this.messagesContainer = null;\r\n    this.input = null;\r\n  }\r\n}\r\n\r\nexport default ChatWidget;\r\n","/**\r\n * Botari Widget - Embeddable Chat Widget\r\n * Main entry point for the library\r\n * \r\n * Usage:\r\n * <script src=\"botari-widget.min.js\"></script>\r\n * <script>\r\n *   BotariWidget.init({\r\n *     businessId: '123',\r\n *     apiKey: 'your-api-key',\r\n *     botName: 'Amina',\r\n *     welcomeMessage: 'Hi! How can I help you today?'\r\n *   });\r\n * </script>\r\n */\r\n\r\nimport type { WidgetConfig, WidgetInstance } from './types';\r\nimport { ChatWidget } from './ChatWidget';\r\nimport './styles.css';\r\n\r\n// Store widget instances\r\nconst instances: Map<string, WidgetInstance> = new Map();\r\n\r\n/**\r\n * Initialize a new Botari Widget instance\r\n * @param config - Widget configuration\r\n * @returns Widget instance with control methods\r\n */\r\nexport function init(config: WidgetConfig): WidgetInstance {\r\n  const instanceId = `${config.businessId}_${Date.now()}`;\r\n  \r\n  const widget = new ChatWidget(config);\r\n  widget.init();\r\n  \r\n  instances.set(instanceId, widget);\r\n  \r\n  // Store reference on window for global access\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__botariWidget = widget;\r\n  }\r\n  \r\n  return widget;\r\n}\r\n\r\n/**\r\n * Get the most recently created widget instance\r\n * @returns The last widget instance or undefined\r\n */\r\nexport function getInstance(): WidgetInstance | undefined {\r\n  const values = Array.from(instances.values());\r\n  return values[values.length - 1];\r\n}\r\n\r\n/**\r\n * Destroy all widget instances\r\n */\r\nexport function destroyAll(): void {\r\n  instances.forEach((instance) => instance.destroy());\r\n  instances.clear();\r\n  \r\n  if (typeof window !== 'undefined') {\r\n    delete (window as any).__botariWidget;\r\n  }\r\n}\r\n\r\n/**\r\n * Version of the widget\r\n */\r\nexport const version = '1.0.0';\r\n\r\n// Default export for UMD build\r\nconst BotariWidget = {\r\n  init,\r\n  getInstance,\r\n  destroyAll,\r\n  version,\r\n};\r\n\r\n// Export for ES modules\r\nexport default BotariWidget;\r\n\r\n// Auto-initialize if config is present in window\r\nif (typeof window !== 'undefined') {\r\n  const w = window as any;\r\n  \r\n  // Expose to window for UMD\r\n  w.BotariWidget = BotariWidget;\r\n  \r\n  // Auto-init if config is present\r\n  if (w.BOTARI_WIDGET_CONFIG) {\r\n    if (document.readyState === 'loading') {\r\n      document.addEventListener('DOMContentLoaded', () => {\r\n        init(w.BOTARI_WIDGET_CONFIG);\r\n      });\r\n    } else {\r\n      init(w.BOTARI_WIDGET_CONFIG);\r\n    }\r\n  }\r\n}\r\n"],"names":["BotariAPI","constructor","config","this","conversationId","apiUrl","apiKey","businessId","getConversationId","setConversationId","id","getHeaders","String","createConversation","customerInfo","response","fetch","method","headers","body","JSON","stringify","customer_name","name","customer_phone","phone","employee_id","ok","error","json","catch","Error","status","data","conversation_id","getMessages","sendMessage","text","sender","reply","closeConversation","console","healthCheck","ICONS","chat","close","send","clear","user","ChatWidget","state","messages","container","button","window","messagesContainer","input","isTyping","autoOpenTimer","customerName","position","primaryColor","welcomeMessage","botName","businessName","placeholder","autoOpen","soundEnabled","customClass","api","storageKey","restoreState","init","warn","createDOM","attachEvents","applyCustomStyles","setTimeout","open","initializeConversation","document","createElement","className","setAttribute","innerHTML","appendChild","header","charAt","inputArea","powered","querySelector","showWelcomeMessage","addEventListener","toggle","e","btn","target","closest","action","getAttribute","handleSend","key","shiftKey","preventDefault","style","height","Math","min","scrollHeight","contains","setProperty","length","addMessage","created_at","Date","toISOString","savedConversationId","localStorage","getItem","parseInt","setItem","showError","value","trim","now","toString","showTypingIndicator","hideTypingIndicator","playNotificationSound","message","push","isBot","messageEl","avatar","time","toLocaleTimeString","hour","minute","escapeHtml","scrollToBottom","indicator","getElementById","remove","errorEl","textContent","scrollTop","div","audioCtx","AudioContext","webkitAudioContext","oscillator","createOscillator","gainNode","createGain","connect","destination","frequency","type","gain","start","stop","currentTime","savedName","saveState","classList","add","_a","focus","removeItem","destroy","clearTimeout","instances","Map","instanceId","widget","set","__botariWidget","getInstance","values","Array","from","destroyAll","forEach","instance","version","BotariWidget","w","BOTARI_WIDGET_CONFIG","readyState"],"mappings":"mPAaO,MAAMA,EAIX,WAAAC,CAAYC,GAFZC,KAAQC,eAAgC,KAGtCD,KAAKD,OAAS,CACZG,OAAQH,EAAOG,QAAU,wBACzBC,OAAQJ,EAAOI,OACfC,WAAYL,EAAOK,WAEvB,CAKA,iBAAAC,GACE,OAAOL,KAAKC,cACd,CAKA,iBAAAK,CAAkBC,GAChBP,KAAKC,eAAiBM,CACxB,CAKQ,UAAAC,GACN,MAAO,CACL,eAAgB,mBAChB,YAAaR,KAAKD,OAAOI,OACzB,gBAAiBM,OAAOT,KAAKD,OAAOK,YAExC,CAKA,wBAAMM,CAAmBC,GACvB,MAAMC,QAAiBC,MAAM,GAAGb,KAAKD,OAAOG,2BAA4B,CACtEY,OAAQ,OACRC,QAASf,KAAKQ,aACdQ,KAAMC,KAAKC,UAAU,CACnBC,qBAAeR,WAAcS,OAAQ,kBACrCC,sBAAgBV,WAAcW,QAAS,GACvCC,YAAa,MAIjB,IAAKX,EAASY,GAAI,CAChB,MAAMC,QAAcb,EAASc,OAAOC,MAAM,KAAA,CAASF,MAAO,mBAC1D,MAAM,IAAIG,MAAMH,EAAMA,OAAS,kCAAkCb,EAASiB,SAC5E,CAEA,MAAMC,QAAyClB,EAASc,OAExD,OADA1B,KAAKC,eAAiB6B,EAAKC,gBACpBD,EAAKC,eACd,CAKA,iBAAMC,CAAY/B,GAChB,MAAMM,EAAKN,GAAkBD,KAAKC,eAClC,IAAKM,EACH,MAAM,IAAIqB,MAAM,gCAGlB,MAAMhB,QAAiBC,MACrB,GAAGb,KAAKD,OAAOG,4BAA4BK,aAC3C,CACEO,OAAQ,MACRC,QAASf,KAAKQ,eAIlB,IAAKI,EAASY,GAAI,CAChB,MAAMC,QAAcb,EAASc,OAAOC,MAAM,KAAA,CAASF,MAAO,mBAC1D,MAAM,IAAIG,MAAMH,EAAMA,OAAS,2BAA2Bb,EAASiB,SACrE,CAEA,OAAOjB,EAASc,MAClB,CAKA,iBAAMO,CAAYC,EAAcC,EAAiB,QAC1CnC,KAAKC,sBACFD,KAAKU,qBAGb,MAAME,QAAiBC,MAAM,GAAGb,KAAKD,OAAOG,sBAAuB,CACjEY,OAAQ,OACRC,QAASf,KAAKQ,aACdQ,KAAMC,KAAKC,UAAU,CACnBa,gBAAiB/B,KAAKC,eACtBkC,SACAD,WAIJ,IAAKtB,EAASY,GAAI,CAChB,MAAMC,QAAcb,EAASc,OAAOC,MAAM,KAAA,CAASF,MAAO,mBAC1D,MAAM,IAAIG,MAAMH,EAAMA,OAAS,2BAA2Bb,EAASiB,SACrE,CAGA,aADwCjB,EAASc,QACrCU,KACd,CAKA,uBAAMC,CAAkBpC,GACtB,MAAMM,EAAKN,GAAkBD,KAAKC,eAClC,IAAKM,EAAI,cAEcM,MACrB,GAAGb,KAAKD,OAAOG,4BAA4BK,UAC3C,CACEO,OAAQ,MACRC,QAASf,KAAKQ,gBAIJgB,IACZc,QAAQb,MAAM,gCAGhBzB,KAAKC,eAAiB,IACxB,CAKA,iBAAMsC,GACJ,IAKE,aAJuB1B,MAAM,GAAGb,KAAKD,OAAOG,gBAAiB,CAC3DY,OAAQ,MACRC,QAAS,CAAE,YAAaf,KAAKD,OAAOI,WAEtBqB,EAClB,CAAA,MACE,OAAO,CACT,CACF,ECxJF,MAAMgB,EAAQ,CACZC,KAAM,uNACNC,MAAO,mNACPC,KAAM,6NAENC,MAAO,yRAEPC,KAAM,2PAGD,MAAMC,EAeX,WAAAhD,CAAYC,GAEV,GAdFC,KAAQ+C,MAAqB,SAC7B/C,KAAQgD,SAAsB,GAC9BhD,KAAQiD,UAAgC,KACxCjD,KAAQkD,OAAmC,KAC3ClD,KAAQmD,OAA6B,KACrCnD,KAAQoD,kBAAwC,KAChDpD,KAAQqD,MAAoC,KAC5CrD,KAAQsD,UAAW,EACnBtD,KAAQuD,cAA+B,KAEvCvD,KAAQwD,aAAuB,OAIxBzD,EAAOK,WACV,MAAM,IAAIwB,MAAM,wCAElB,IAAK7B,EAAOI,OACV,MAAM,IAAIyB,MAAM,oCAIlB5B,KAAKD,OAAS,CACZK,WAAYL,EAAOK,WACnBD,OAAQJ,EAAOI,OACfD,OAAQH,EAAOG,QAAU,wBACzBuD,SAAU1D,EAAO0D,UAAY,eAC7BC,aAAc3D,EAAO2D,cAAgB,UACrCC,eAAgB5D,EAAO4D,gBAAkB,mCACzCC,QAAS7D,EAAO6D,SAAW,mBAC3BC,aAAc9D,EAAO8D,cAAgB,YACrCC,YAAa/D,EAAO+D,aAAe,oBACnCC,SAAUhE,EAAOgE,UAAY,EAC7BC,cAAsC,IAAxBjE,EAAOiE,aACrBC,YAAalE,EAAOkE,aAAe,IAGrCjE,KAAKkE,IAAM,IAAIrE,EAAUG,KAAKD,QAC9BC,KAAKmE,WAAa,iBAAiBnE,KAAKD,OAAOK,aAG/CJ,KAAKoE,cACP,CAKA,IAAAC,GACMrE,KAAKiD,UACPX,QAAQgC,KAAK,sCAIftE,KAAKuE,YACLvE,KAAKwE,eACLxE,KAAKyE,oBAGDzE,KAAKD,OAAOgE,SAAW,IACzB/D,KAAKuD,cAAgBJ,OAAOuB,WAAW,KACrC1E,KAAK2E,QACJ3E,KAAKD,OAAOgE,WAIjB/D,KAAK4E,yBACP,CAKQ,SAAAL,GAENvE,KAAKiD,UAAY4B,SAASC,cAAc,OACxC9E,KAAKiD,UAAU8B,UAAY,gCAAgC/E,KAAKD,OAAO0D,YAAYzD,KAAKD,OAAOkE,cAC/FjE,KAAKiD,UAAU+B,aAAa,OAAQ,UACpChF,KAAKiD,UAAU+B,aAAa,aAAc,sBAG1ChF,KAAKkD,OAAS2B,SAASC,cAAc,UACrC9E,KAAKkD,OAAO6B,UAAY,wBACxB/E,KAAKkD,OAAO8B,aAAa,aAAc,aACvChF,KAAKkD,OAAO+B,UAAYzC,EAAMC,KAC9BzC,KAAKiD,UAAUiC,YAAYlF,KAAKkD,QAGhClD,KAAKmD,OAAS0B,SAASC,cAAc,OACrC9E,KAAKmD,OAAO4B,UAAY,wBACxB/E,KAAKmD,OAAO6B,aAAa,OAAQ,UACjChF,KAAKmD,OAAO6B,aAAa,aAAc,gBAGvC,MAAMG,EAASN,SAASC,cAAc,OACtCK,EAAOJ,UAAY,wBACnBI,EAAOF,UAAY,gGAEsBjF,KAAKD,OAAO6D,QAAQwB,OAAO,6GAExBpF,KAAKD,OAAO6D,mXAShDpB,EAAMI,0JAGNJ,EAAME,+CAId1C,KAAKmD,OAAO+B,YAAYC,GAGxBnF,KAAKoD,kBAAoByB,SAASC,cAAc,OAChD9E,KAAKoD,kBAAkB2B,UAAY,0BACnC/E,KAAKmD,OAAO+B,YAAYlF,KAAKoD,mBAG7B,MAAMiC,EAAYR,SAASC,cAAc,OACzCO,EAAUN,UAAY,4BACtBM,EAAUJ,UAAY,mFAGHjF,KAAKD,OAAO+D,uKAKzBtB,EAAMG,8BAGZ3C,KAAKmD,OAAO+B,YAAYG,GAGxB,MAAMC,EAAUT,SAASC,cAAc,OACvCQ,EAAQP,UAAY,yBACpBO,EAAQL,UAAY,yEAAyEjF,KAAKD,OAAO8D,mBACzG7D,KAAKmD,OAAO+B,YAAYI,GAExBtF,KAAKiD,UAAUiC,YAAYlF,KAAKmD,QAGhCnD,KAAKqD,MAAQgC,EAAUE,cAAc,yBAGrCV,SAAS7D,KAAKkE,YAAYlF,KAAKiD,WAG/BjD,KAAKwF,oBACP,CAKQ,YAAAhB,GACN,IAAKxE,KAAKkD,SAAWlD,KAAKmD,SAAWnD,KAAKqD,MAAO,OAGjDrD,KAAKkD,OAAOuC,iBAAiB,QAAS,IAAMzF,KAAK0F,UAGjD1F,KAAKmD,OAAOsC,iBAAiB,QAAUE,IACrC,MACMC,EADSD,EAAEE,OACEC,QAAQ,iBAC3B,GAAIF,EAAK,CACP,MAAMG,EAASH,EAAII,aAAa,eACjB,UAAXD,GAAoB/F,KAAK0C,QACd,UAAXqD,GAAoB/F,KAAK4C,OAC/B,IAIc5C,KAAKmD,OAAOoC,cAAc,4BAClCE,iBAAiB,QAAS,IAAMzF,KAAKiG,cAG7CjG,KAAKqD,MAAMoC,iBAAiB,UAAYE,IACxB,UAAVA,EAAEO,KAAoBP,EAAEQ,WAC1BR,EAAES,iBACFpG,KAAKiG,gBAKTjG,KAAKqD,MAAMoC,iBAAiB,QAAS,KACnCzF,KAAKqD,MAAOgD,MAAMC,OAAS,OAC3BtG,KAAKqD,MAAOgD,MAAMC,OAASC,KAAKC,IAAIxG,KAAKqD,MAAOoD,aAAc,KAAO,OAIvE5B,SAASY,iBAAiB,QAAUE,IAClC,MAAME,EAASF,EAAEE,OACE,SAAf7F,KAAK+C,OACJ/C,KAAKmD,OAAQuD,SAASb,IACtB7F,KAAKkD,OAAQwD,SAASb,IACzB7F,KAAK0C,SAGX,CAKQ,iBAAA+B,GAC2B,YAA7BzE,KAAKD,OAAO2D,cAA8B1D,KAAKiD,WACjDjD,KAAKiD,UAAUoD,MAAMM,YAAY,mBAAoB3G,KAAKD,OAAO2D,aAErE,CAKQ,kBAAA8B,GACuB,IAAzBxF,KAAKgD,SAAS4D,QAChB5G,KAAK6G,WAAW,CACdtG,GAAI,UACJwB,gBAAiB,EACjBI,OAAQ,MACRD,KAAMlC,KAAKD,OAAO4D,eAClBmD,YAAA,IAAgBC,MAAOC,eAG7B,CAKA,4BAAcpC,GACZ,IAEE,MAAMqC,EAAsBC,aAAaC,QAAQ,GAAGnH,KAAKmE,8BACzD,GAAI8C,EACFjH,KAAKkE,IAAI5D,kBAAkB8G,SAASH,EAAqB,SAEpD,CAEL,MAAMhH,QAAuBD,KAAKkE,IAAIxD,mBAAmB,CACvDU,KAAMpB,KAAKwD,eAEb0D,aAAaG,QAAQ,GAAGrH,KAAKmE,6BAA8B1D,OAAOR,GACpE,CACF,OAASwB,GACPa,QAAQb,MAAM,kDAAmDA,GACjEzB,KAAKsH,UAAU,kDACjB,CACF,CAKA,gBAAcrB,GACZ,IAAKjG,KAAKqD,OAASrD,KAAKsD,SAAU,OAElC,MAAMpB,EAAOlC,KAAKqD,MAAMkE,MAAMC,OACzBtF,IAGLlC,KAAKqD,MAAMkE,MAAQ,GACnBvH,KAAKqD,MAAMgD,MAAMC,OAAS,aAEpBtG,KAAKiC,YAAYC,GACzB,CAKA,iBAAMD,CAAYC,GAEhBlC,KAAK6G,WAAW,CACdtG,GAAIwG,KAAKU,MAAMC,WACf3F,gBAAiB/B,KAAKkE,IAAI7D,qBAAuB,EACjD8B,OAAQ,OACRD,OACA4E,YAAA,IAAgBC,MAAOC,gBAIzBhH,KAAK2H,sBAEL,IAEE,MAAMvF,QAAcpC,KAAKkE,IAAIjC,YAAYC,EAAM,QAG/ClC,KAAK4H,sBAGL5H,KAAK6G,WAAW,CACdtG,IAAKwG,KAAKU,MAAQ,GAAGC,WACrB3F,gBAAiB/B,KAAKkE,IAAI7D,qBAAuB,EACjD8B,OAAQ,MACRD,KAAME,EACN0E,YAAA,IAAgBC,MAAOC,gBAIrBhH,KAAKD,OAAOiE,cACdhE,KAAK6H,uBAET,OAASpG,GACPzB,KAAK4H,sBACLtF,QAAQb,MAAM,uCAAwCA,GACtDzB,KAAKsH,UAAU,4CACjB,CACF,CAKQ,UAAAT,CAAWiB,GAGjB,GAFA9H,KAAKgD,SAAS+E,KAAKD,IAEd9H,KAAKoD,kBAAmB,OAE7B,MAAM4E,EAA2B,QAAnBF,EAAQ3F,QAAuC,WAAnB2F,EAAQ3F,OAC5C8F,EAAYpD,SAASC,cAAc,OACzCmD,EAAUlD,UAAY,mDAAkDiD,EAAQ,MAAQ,QAExF,MAAME,EAASF,EAAQ,KAAOxF,EAAMK,KAC9BsF,EAAO,IAAIpB,KAAKe,EAAQhB,YAAYsB,mBAAmB,GAAI,CAC/DC,KAAM,UACNC,OAAQ,YAGVL,EAAUhD,UAAY,gEAEhB+C,EAAQE,EAAS,kZAG0BlI,KAAKuI,WAAWT,EAAQ5F,kEACzBiG,+BAIhDnI,KAAKoD,kBAAkB8B,YAAY+C,GACnCjI,KAAKwI,gBACP,CAKQ,mBAAAb,GAEN,GADA3H,KAAKsD,UAAW,GACXtD,KAAKoD,kBAAmB,OAE7B,MAAMqF,EAAY5D,SAASC,cAAc,OACzC2D,EAAU1D,UAAY,wBACtB0D,EAAUlI,GAAK,0BACfkI,EAAUxD,UAAY,6SAStBjF,KAAKoD,kBAAkB8B,YAAYuD,GACnCzI,KAAKwI,gBACP,CAKQ,mBAAAZ,GACN5H,KAAKsD,UAAW,EAChB,MAAMmF,EAAY5D,SAAS6D,eAAe,2BACtCD,GACFA,EAAUE,QAEd,CAKQ,SAAArB,CAAUQ,GAChB,IAAK9H,KAAKoD,kBAAmB,OAE7B,MAAMwF,EAAU/D,SAASC,cAAc,OACvC8D,EAAQ7D,UAAY,uBACpB6D,EAAQC,YAAcf,EAEtB9H,KAAKoD,kBAAkB8B,YAAY0D,GACnC5I,KAAKwI,iBAGL9D,WAAW,IAAMkE,EAAQD,SAAU,IACrC,CAKQ,cAAAH,GACFxI,KAAKoD,oBACPpD,KAAKoD,kBAAkB0F,UAAY9I,KAAKoD,kBAAkBqD,aAE9D,CAKQ,UAAA8B,CAAWrG,GACjB,MAAM6G,EAAMlE,SAASC,cAAc,OAEnC,OADAiE,EAAIF,YAAc3G,EACX6G,EAAI9D,SACb,CAKQ,qBAAA4C,GAEN,IACE,MAAMmB,EAAW,IAAK7F,OAAO8F,cAAiB9F,OAAe+F,oBACvDC,EAAaH,EAASI,mBACtBC,EAAWL,EAASM,aAE1BH,EAAWI,QAAQF,GACnBA,EAASE,QAAQP,EAASQ,aAE1BL,EAAWM,UAAUlC,MAAQ,IAC7B4B,EAAWO,KAAO,OAClBL,EAASM,KAAKpC,MAAQ,GAEtB4B,EAAWS,QACXT,EAAWU,KAAKb,EAASc,YAAc,GACzC,CAAA,MAEA,CACF,CAKQ,YAAA1F,GACN,MAAM2F,EAAY7C,aAAaC,QAAQ,GAAGnH,KAAKmE,4BAC3C4F,IACF/J,KAAKwD,aAAeuG,EAExB,CAKQ,SAAAC,GACN9C,aAAaG,QAAQ,GAAGrH,KAAKmE,2BAA4BnE,KAAKwD,aAChE,CAIA,IAAAmB,GACqB,SAAf3E,KAAK+C,OAAqB/C,KAAKmD,QAAWnD,KAAKkD,SAEnDlD,KAAK+C,MAAQ,OACb/C,KAAKmD,OAAO8G,UAAUC,IAAI,+BAC1BlK,KAAKkD,OAAO+B,UAAYzC,EAAME,MAC9B1C,KAAKkD,OAAO8B,aAAa,aAAc,cAGnChF,KAAKqD,OACPqB,WAAW,WAAM,OAAA,OAAAyF,EAAAnK,KAAKqD,YAAL,EAAA8G,EAAYC,SAAS,KAGxCpK,KAAKgK,YACP,CAEA,KAAAtH,GACqB,WAAf1C,KAAK+C,OAAuB/C,KAAKmD,QAAWnD,KAAKkD,SAErDlD,KAAK+C,MAAQ,SACb/C,KAAKmD,OAAO8G,UAAUtB,OAAO,+BAC7B3I,KAAKkD,OAAO+B,UAAYzC,EAAMC,KAC9BzC,KAAKkD,OAAO8B,aAAa,aAAc,aAEvChF,KAAKgK,YACP,CAEA,MAAAtE,GACqB,SAAf1F,KAAK+C,MACP/C,KAAK0C,QAEL1C,KAAK2E,MAET,CAEA,KAAA/B,GACE5C,KAAKgD,SAAW,GACZhD,KAAKoD,oBACPpD,KAAKoD,kBAAkB6B,UAAY,IAErCjF,KAAKwF,qBAGL0B,aAAamD,WAAW,GAAGrK,KAAKmE,8BAChCnE,KAAK4E,wBACP,CAEA,OAAA0F,GAEMtK,KAAKuD,eACPgH,aAAavK,KAAKuD,eAIpBvD,KAAKkE,IAAI7B,oBAGLrC,KAAKiD,WACPjD,KAAKiD,UAAU0F,SAIjB3I,KAAKiD,UAAY,KACjBjD,KAAKkD,OAAS,KACdlD,KAAKmD,OAAS,KACdnD,KAAKoD,kBAAoB,KACzBpD,KAAKqD,MAAQ,IACf,EC1gBF,MAAMmH,MAA6CC,IAO5C,SAASpG,EAAKtE,GACnB,MAAM2K,EAAa,GAAG3K,EAAOK,cAAc2G,KAAKU,QAE1CkD,EAAS,IAAI7H,EAAW/C,GAU9B,OATA4K,EAAOtG,OAEPmG,EAAUI,IAAIF,EAAYC,GAGJ,oBAAXxH,SACRA,OAAe0H,eAAiBF,GAG5BA,CACT,CAMO,SAASG,IACd,MAAMC,EAASC,MAAMC,KAAKT,EAAUO,UACpC,OAAOA,EAAOA,EAAOnE,OAAS,EAChC,CAKO,SAASsE,IACdV,EAAUW,QAASC,GAAaA,EAASd,WACzCE,EAAU5H,QAEY,oBAAXO,eACDA,OAAe0H,cAE3B,CAKO,MAAMQ,EAAU,QAGjBC,EAAe,CACnBjH,OACAyG,cACAI,aACAG,WAOF,GAAsB,oBAAXlI,OAAwB,CACjC,MAAMoI,EAAIpI,OAGVoI,EAAED,aAAeA,EAGbC,EAAEC,uBACwB,YAAxB3G,SAAS4G,WACX5G,SAASY,iBAAiB,mBAAoB,KAC5CpB,EAAKkH,EAAEC,wBAGTnH,EAAKkH,EAAEC,sBAGb"}